{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h1 mb-0">Entries</h1>
    <div class="d-flex gap-2">
        <a href="/categories" class="btn btn-outline-primary">
            <i class="bi bi-tags me-1"></i>
            Manage Categories
        </a>
    </div>
</div>

<!-- Date Filter Section -->
<div class="card mb-4">
    <div class="card-body">
        <h6 class="card-title mb-3">
            <i class="bi bi-calendar-range me-2"></i>
            Filter by Date Range
        </h6>
        <form method="GET" action="/entries" class="row g-3 align-items-end">
            <div class="col-md-3 col-12">
                <label for="start_date" class="form-label">Start Date</label>
                <input type="date" 
                       class="form-control" 
                       id="start_date" 
                       name="start" 
                       value="{{ start_date or '' }}">
            </div>
            <div class="col-md-3 col-12">
                <label for="end_date" class="form-label">End Date</label>
                <input type="date" 
                       class="form-control" 
                       id="end_date" 
                       name="end" 
                       value="{{ end_date or '' }}">
            </div>
            <div class="col-md-3 col-12">
                <label for="category_filter" class="form-label">Category</label>
                <select class="form-control" 
                        id="category_filter" 
                        name="category">
                    <option value="">All Categories</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if selected_category and selected_category == category.id|string %}selected{% endif %}>
                            {{ category.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3 col-12">
                <div class="d-flex gap-2 flex-wrap">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-search me-1"></i>
                        Filter
                    </button>
                    <a href="/entries" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle me-1"></i>
                        Clear
                    </a>
                </div>
            </div>
            <!-- Export buttons - separate row for mobile -->
            <div class="col-12 mt-3">
                <div class="d-flex gap-2 flex-wrap justify-content-center">
                    <button type="button" class="btn btn-outline-success" onclick="exportToExcel()" title="Export to Excel">
                        <i class="bi bi-file-earmark-excel me-1"></i>
                        Excel Report
                    </button>
                    <button type="button" class="btn btn-outline-danger" onclick="exportToPDF()" title="Export to PDF">
                        <i class="bi bi-file-earmark-pdf me-1"></i>
                        PDF Report
                    </button>
                </div>
            </div>
        </form>
        {% if start_date and end_date or selected_category %}
        <div class="mt-3">
            <small class="text-light" style="opacity: 0.8;">
                <i class="bi bi-info-circle me-1"></i>
                {% if start_date and end_date %}
                    Showing entries from {{ start_date }} to {{ end_date }}
                {% endif %}
                {% if selected_category %}
                    {% for category in categories %}
                        {% if category.id|string == selected_category %}
                            {% if start_date and end_date %} - {% endif %}in category "{{ category.name }}"
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </small>
        </div>
        {% endif %}
    </div>
</div>

<!-- Improved Add form with better styling -->
<div class="card bg-gradient mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
  <div class="card-body">
    <h5 class="text-white mb-3">Add New Entry</h5>
    <form
      id="entry-add-form"
      class="row g-3 align-items-end"
      hx-post="/entries/create"
      hx-target="#entries-tbody"
      hx-swap="innerHTML"
      hx-disabled-elt="button">
      
      <!-- Hidden field to pass user currency -->
      <input type="hidden" name="currency_code" value="{{ user_currency }}">

      <!-- Type -->
      <div class="col-12 col-md-2">
        <label class="form-label text-white-50 small">Type</label>
        <select name="type" class="form-select form-select-lg shadow-sm" required>
          <option value="expense">Expense</option>
          <option value="income">Income</option>
        </select>
      </div>

      <!-- Amount -->
      <div class="col-12 col-md-2">
        <label class="form-label text-white-50 small">Amount ({{ user_currency }})</label>
        <input name="amount" type="number" step="0.01" 
               class="form-control form-control-lg shadow-sm" 
               placeholder="0.00" required>
      </div>

      <!-- Category -->
      <div class="col-12 col-md-3">
        <label class="form-label text-white-50 small">Category</label>
        <select name="category_id" class="form-select form-select-lg shadow-sm">
          <option value="">(No category)</option>
          {% for c in categories %}
            <option value="{{ c.id }}">{{ c.name }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Date -->
      <div class="col-12 col-md-2">
        <label class="form-label text-white-50 small">Date</label>
        <input name="date_str" type="date" 
               class="form-control form-control-lg shadow-sm" 
               value="{{ today }}" required>
      </div>

      <!-- Note & submit -->
      <div class="col-12 col-md-3">
        <label class="form-label text-white-50 small">Note</label>
        <div class="d-flex gap-2">
          <input name="note" type="text" 
                 class="form-control form-control-lg shadow-sm" 
                 placeholder="Optional note"
                 id="entry-note"
                 oninput="getAISuggestion()">
          <button type="submit" class="btn btn-success btn-lg shadow">
            <i class="bi bi-plus-circle"></i> Add
          </button>
        </div>
        
        <!-- AI Suggestion Display -->
        <div id="ai-suggestion" class="mt-2" style="display: none;">
          <div class="alert alert-info alert-sm py-2 px-3 mb-2">
            <div class="d-flex align-items-center">
              <i class="bi bi-robot me-2"></i>
              <div class="flex-grow-1">
                <small class="fw-bold">AI Suggestion:</small>
                <div id="suggestion-text" class="small"></div>
              </div>
              <div class="flex-shrink-0">
                <button type="button" class="btn btn-sm btn-outline-success me-1" onclick="acceptAISuggestion()">
                  <i class="bi bi-check"></i>
                </button>
                <button type="button" class="btn btn-sm btn-outline-danger" onclick="dismissAISuggestion()">
                  <i class="bi bi-x"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <small class="htmx-indicator text-white-50">Savingâ€¦</small>
      </div>
    </form>
  </div>
</div>

<!-- Table list with improved styling -->
<div class="card shadow">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-dark table-hover table-borderless align-middle mb-0">
        <thead class="table-secondary">
          <tr>
            <th style="width:14%">Date</th>
            <th style="width:14%">Type</th>
            <th style="width:14%">Amount</th>
            <th style="width:18%">Category</th>
            <th>Note</th>
            <th class="text-end" style="width:18%">Actions</th>
          </tr>
        </thead>
        <tbody id="entries-tbody">
          {% include "entries/_list.html" %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Add custom styles -->
<style>
  /* Date filter styling */
  .card {
    background: var(--panel);
    border: 1px solid #1c2440;
    border-radius: 14px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
  }
  
  .card-title {
    color: #ffffff;
    font-weight: 600;
  }
  
  .form-label {
    color: #ffffff;
    font-weight: 500;
    font-size: 0.875rem;
  }
  
  
  .form-control::placeholder {
    color: #cbd5e1;
  }
  
  /* Date input specific styling */
  input[type="date"] {
    color: #374151 !important;
    background: rgba(255, 255, 255, 0.95) !important;
    border: 2px solid transparent !important;
  }
  
  input[type="date"]:focus {
    color: #374151 !important;
    background: white !important;
    border-color: #667eea !important;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
  }
  
  input[type="date"]:hover {
    color: #374151 !important;
    background: white !important;
    border-color: #667eea !important;
  }
  
  /* Date input calendar icon styling */
  input[type="date"]::-webkit-calendar-picker-indicator {
    filter: none;
    cursor: pointer;
  }
  
  /* Firefox date input styling */
  input[type="date"]::-moz-datetime-edit-text {
    color: #374151 !important;
  }
  
  input[type="date"]::-moz-datetime-edit-month-field,
  input[type="date"]::-moz-datetime-edit-day-field,
  input[type="date"]::-moz-datetime-edit-year-field {
    color: #374151 !important;
  }
  
  /* Additional date input styling for better cross-browser support */
  input[type="date"]::-webkit-datetime-edit-text {
    color: #374151 !important;
  }
  
  input[type="date"]::-webkit-datetime-edit-month-field,
  input[type="date"]::-webkit-datetime-edit-day-field,
  input[type="date"]::-webkit-datetime-edit-year-field {
    color: #374151 !important;
  }
  
  /* Ensure date input text is always visible */
  input[type="date"] {
    -webkit-text-fill-color: #374151 !important;
    -webkit-opacity: 1 !important;
    opacity: 1 !important;
  }
  
  .btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    font-weight: 600;
  }
  
  .btn-primary:hover {
    background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
  }
  
  .btn-outline-primary {
    border-color: #667eea;
    color: #667eea;
  }
  
  .btn-outline-primary:hover {
    background: #667eea;
    border-color: #667eea;
    color: white;
  }
  
  .btn-outline-secondary {
    border-color: #6b7280;
    color: #6b7280;
  }
  
  .btn-outline-secondary:hover {
    background: #6b7280;
    border-color: #6b7280;
    color: white;
  }

  /* Form improvements */
  .bg-gradient {
    border: none;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  }
  
  .form-control:focus, .form-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
  }
  
  .form-control, .form-select {
    background-color: rgba(255, 255, 255, 0.95);
    border: 2px solid transparent;
    transition: all 0.3s ease;
    color: #374151 !important;
  }
  
  .form-control:hover, .form-select:hover {
    background-color: white;
    border-color: #667eea;
    color: #374151 !important;
  }
  
  .form-control:focus, .form-select:focus {
    background-color: white;
    border-color: #667eea;
    color: #374151 !important;
  }

  /* Table text improvements for better readability */
  .table-dark td {
    color: #e2e8f0 !important;
  }
  
  .table-dark .text-body {
    color: #e2e8f0 !important;
  }
  
  .table-dark .text-secondary {
    color: #9ca3af !important;
  }
  
  /* Expense/Income color coding */
  .expense-type {
    color: #ef4444 !important;
    font-weight: 500;
  }
  
  .income-type {
    color: #10b981 !important;
    font-weight: 500;
  }
  
  .expense-amount {
    color: #fca5a5 !important;
  }
  
  .income-amount {
    color: #86efac !important;
  }

  /* Badge styles for type */
  .type-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    font-weight: 600;
    display: inline-block;
  }
  
  .type-badge.expense {
    background-color: rgba(239, 68, 68, 0.1);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.2);
  }
  
  .type-badge.income {
    background-color: rgba(16, 185, 129, 0.1);
    color: #10b981;
    border: 1px solid rgba(16, 185, 129, 0.2);
  }

  /* Button improvements */
  .btn-success {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border: none;
  }
  
  .btn-success:hover {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
  }

  /* Edit row styling */
  .bg-dark-subtle {
    background-color: rgba(255, 255, 255, 0.05) !important;
  }
  
  .bg-dark-subtle .edit-input,
  .bg-dark-subtle .edit-select {
    background-color: rgba(255, 255, 255, 0.1) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    color: #e2e8f0 !important;
    width: 100% !important;
    min-width: 0 !important;
  }
  
  .bg-dark-subtle .edit-input:focus,
  .bg-dark-subtle .edit-select:focus {
    background-color: rgba(255, 255, 255, 0.15) !important;
    border-color: #10b981 !important;
    box-shadow: 0 0 0 0.2rem rgba(16, 185, 129, 0.25) !important;
    color: #e2e8f0 !important;
  }
  
  .bg-dark-subtle .edit-input::placeholder {
    color: #9ca3af !important;
  }
  
  /* Fix dropdown options styling - this won't work in most browsers */
  /* We need to use a different approach for dropdown styling */
  .bg-dark-subtle .edit-select {
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath fill='%23e2e8f0' d='m4.427 9.427 3.396 3.396a.25.25 0 0 0 .354 0l3.396-3.396A.25.25 0 0 0 11.396 9H4.604a.25.25 0 0 0-.177.427Z'/%3E%3C/svg%3E") !important;
    background-repeat: no-repeat !important;
    background-position: right 0.75rem center !important;
    background-size: 16px 12px !important;
  }
  
  /* Fix for when dropdown is active/opened */
  .bg-dark-subtle .edit-select:active,
  .bg-dark-subtle .edit-select:focus {
    background-color: rgba(255, 255, 255, 0.15) !important;
    color: #e2e8f0 !important;
  }
  
  /* Table cell padding for edit rows */
  .bg-dark-subtle td {
    padding: 8px !important;
    vertical-align: middle !important;
  }
  
  /* Button spacing in edit row */
  .bg-dark-subtle .btn {
    margin: 0 2px;
  }
  
  /* Additional dropdown fixes for better consistency */
  .bg-dark-subtle .edit-select {
    appearance: none !important;
    -webkit-appearance: none !important;
    -moz-appearance: none !important;
  }
  
  /* Ensure dropdown doesn't turn white on any interaction */
  .bg-dark-subtle .edit-select:hover,
  .bg-dark-subtle .edit-select:active,
  .bg-dark-subtle .edit-select:visited {
    background-color: rgba(255, 255, 255, 0.1) !important;
    color: #e2e8f0 !important;
  }
  
  /* Fix for dropdown arrow */
  .bg-dark-subtle .edit-select::after {
    color: #e2e8f0 !important;
  }
  
  /* Ensure form elements don't overflow their containers */
  .bg-dark-subtle .edit-input,
  .bg-dark-subtle .edit-select {
    max-width: 100% !important;
    box-sizing: border-box !important;
  }
  
  /* Edit form layout improvements */
  .bg-dark-subtle form {
    width: 100% !important;
    margin: 0 !important;
  }
  
  .bg-dark-subtle form > div {
    flex-shrink: 0 !important;
  }
  
  /* Better spacing for edit form */
  .bg-dark-subtle .py-2 {
    padding-top: 0.5rem !important;
    padding-bottom: 0.5rem !important;
  }
  
  .bg-dark-subtle .px-3 {
    padding-left: 1rem !important;
    padding-right: 1rem !important;
  }
  
  /* Ensure dropdown doesn't turn white on any state */
  .bg-dark-subtle .edit-select,
  .bg-dark-subtle .edit-select:focus,
  .bg-dark-subtle .edit-select:active,
  .bg-dark-subtle .edit-select:hover {
    background-color: rgba(255, 255, 255, 0.1) !important;
    color: #e2e8f0 !important;
    border-color: rgba(255, 255, 255, 0.2) !important;
  }
  
  /* Force dark theme for all form elements */
  .bg-dark-subtle input,
  .bg-dark-subtle select {
    background-color: rgba(255, 255, 255, 0.1) !important;
    color: #e2e8f0 !important;
    border-color: rgba(255, 255, 255, 0.2) !important;
  }
  
  .bg-dark-subtle input:focus,
  .bg-dark-subtle select:focus {
    background-color: rgba(255, 255, 255, 0.15) !important;
    color: #e2e8f0 !important;
    border-color: #10b981 !important;
    box-shadow: 0 0 0 0.2rem rgba(16, 185, 129, 0.25) !important;
  }
</style>

<script>
let currentSuggestion = null;
let suggestionTimeout = null;

function getAISuggestion() {
    const note = document.getElementById('entry-note').value.trim();
    const amount = document.querySelector('input[name="amount"]').value;
    const type = document.querySelector('select[name="type"]').value;
    
    // Clear previous timeout
    if (suggestionTimeout) {
        clearTimeout(suggestionTimeout);
    }
    
    // Only get suggestion if note has at least 3 characters
    if (note.length < 3) {
        dismissAISuggestion();
        return;
    }
    
    // Debounce the request
    suggestionTimeout = setTimeout(() => {
        const formData = new FormData();
        formData.append('note', note);
        formData.append('amount', amount);
        formData.append('entry_type', type);
        
        fetch('/ai/suggest-category', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success && data.suggestion) {
                showAISuggestion(data.suggestion);
            } else {
                dismissAISuggestion();
            }
        })
        .catch(error => {
            console.error('AI suggestion error:', error);
            dismissAISuggestion();
        });
    }, 500);
}

function showAISuggestion(suggestion) {
    currentSuggestion = suggestion;
    const suggestionDiv = document.getElementById('ai-suggestion');
    const suggestionText = document.getElementById('suggestion-text');
    
    const confidence = Math.round(suggestion.confidence_score * 100);
    suggestionText.innerHTML = `
        <strong>${suggestion.category_name}</strong> 
        <span class="badge bg-primary">${confidence}% confidence</span>
    `;
    
    suggestionDiv.style.display = 'block';
}

function acceptAISuggestion() {
    if (currentSuggestion) {
        // Set the category in the form
        const categorySelect = document.querySelector('select[name="category_id"]');
        categorySelect.value = currentSuggestion.category_id;
        
        // Add visual feedback
        categorySelect.style.borderColor = '#28a745';
        categorySelect.style.boxShadow = '0 0 0 0.2rem rgba(40, 167, 69, 0.25)';
        
        setTimeout(() => {
            categorySelect.style.borderColor = '';
            categorySelect.style.boxShadow = '';
        }, 2000);
        
        dismissAISuggestion();
        
        // Show success message
        showToast('AI suggestion applied!', 'success');
    }
}

function dismissAISuggestion() {
    const suggestionDiv = document.getElementById('ai-suggestion');
    suggestionDiv.style.display = 'none';
    currentSuggestion = null;
}

function showToast(message, type = 'info') {
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast align-items-center text-white bg-${type} border-0`;
    toast.setAttribute('role', 'alert');
    toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                <i class="bi bi-robot me-2"></i>
                ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    `;
    
    // Add to page
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
        toastContainer.style.zIndex = '9999';
        document.body.appendChild(toastContainer);
    }
    
    toastContainer.appendChild(toast);
    
    // Initialize and show toast
    const bsToast = new bootstrap.Toast(toast);
    bsToast.show();
    
    // Remove from DOM after hiding
    toast.addEventListener('hidden.bs.toast', () => {
        toast.remove();
    });
}

// Initialize AI suggestions when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Check if AI features are enabled
    fetch('/ai/insights')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('AI features are available');
            }
        })
        .catch(error => {
            console.log('AI features not available');
        });
    
    // Date filter enhancements
    const startDateInput = document.getElementById('start_date');
    const endDateInput = document.getElementById('end_date');
    
    // Set default date range to current month if no dates are set
    if (!startDateInput.value && !endDateInput.value) {
        const today = new Date();
        const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
        const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
        
        startDateInput.value = firstDay.toISOString().split('T')[0];
        endDateInput.value = lastDay.toISOString().split('T')[0];
    }
    
    // Validate date range
    function validateDateRange() {
        const startDate = new Date(startDateInput.value);
        const endDate = new Date(endDateInput.value);
        
        if (startDate && endDate && startDate > endDate) {
            endDateInput.setCustomValidity('End date must be after start date');
            endDateInput.reportValidity();
        } else {
            endDateInput.setCustomValidity('');
        }
    }
    
    startDateInput.addEventListener('change', validateDateRange);
    endDateInput.addEventListener('change', validateDateRange);
    
    // Quick date range buttons
    addQuickDateButtons();
});

function addQuickDateButtons() {
    const dateFilterCard = document.querySelector('.card .card-body');
    if (!dateFilterCard) return;
    
    const quickButtonsContainer = document.createElement('div');
    quickButtonsContainer.className = 'mt-3';
    quickButtonsContainer.innerHTML = `
        <div class="d-flex flex-wrap gap-2">
            <small class="text-light me-2" style="opacity: 0.8;">Quick filters:</small>
            <button type="button" class="btn btn-sm btn-outline-info" onclick="setDateRange('today')">Today</button>
            <button type="button" class="btn btn-sm btn-outline-info" onclick="setDateRange('week')">This Week</button>
            <button type="button" class="btn btn-sm btn-outline-info" onclick="setDateRange('month')">This Month</button>
            <button type="button" class="btn btn-sm btn-outline-info" onclick="setDateRange('year')">This Year</button>
        </div>
    `;
    
    dateFilterCard.appendChild(quickButtonsContainer);
}

function setDateRange(range) {
    const today = new Date();
    const startDateInput = document.getElementById('start_date');
    const endDateInput = document.getElementById('end_date');
    
    let startDate, endDate;
    
    switch(range) {
        case 'today':
            startDate = endDate = today;
            break;
        case 'week':
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            startDate = startOfWeek;
            endDate = today;
            break;
        case 'month':
            startDate = new Date(today.getFullYear(), today.getMonth(), 1);
            endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            break;
        case 'year':
            startDate = new Date(today.getFullYear(), 0, 1);
            endDate = new Date(today.getFullYear(), 11, 31);
            break;
    }
    
    startDateInput.value = startDate.toISOString().split('T')[0];
    endDateInput.value = endDate.toISOString().split('T')[0];
    
    // Auto-submit the form
    document.querySelector('form[method="GET"]').submit();
}

// Export functions
function getCurrentFilters() {
    const start = document.getElementById('start_date').value;
    const end = document.getElementById('end_date').value;
    const category = document.getElementById('category_filter').value;
    
    const params = new URLSearchParams();
    if (start) params.append('start', start);
    if (end) params.append('end', end);
    if (category) params.append('category', category);
    
    return params.toString();
}

function exportToExcel() {
    const filters = getCurrentFilters();
    const url = `/reports/excel/entries?${filters}`;
    window.open(url, '_blank');
}

function exportToPDF() {
    const filters = getCurrentFilters();
    const url = `/reports/pdf/financial?${filters}`;
    window.open(url, '_blank');
}
</script>

<style>
/* Mobile Responsive Design for Entries Page */
@media (max-width: 768px) {
  /* Make form inputs stack vertically on mobile */
  .row.g-3 .col-md-3 {
    margin-bottom: 1rem;
  }
  
  /* Improve button spacing on mobile */
  .d-flex.gap-2.flex-wrap {
    justify-content: center;
    gap: 0.75rem !important;
  }
  
  .d-flex.gap-2.flex-wrap .btn {
    padding: 12px 16px;
    min-height: 48px;
    font-size: 0.9rem;
    flex: 1;
    min-width: 120px;
  }
  
  /* Export buttons - make them full width on mobile */
  .col-12 .d-flex.gap-2.flex-wrap {
    flex-direction: column;
    gap: 0.75rem !important;
  }
  
  .col-12 .d-flex.gap-2.flex-wrap .btn {
    width: 100%;
    padding: 14px 16px;
    min-height: 52px;
    font-size: 1rem;
  }
  
  /* Improve table responsiveness */
  .table-responsive {
    font-size: 0.9rem;
  }
  
  .table th,
  .table td {
    padding: 0.75rem 0.5rem;
    word-break: break-word;
  }
  
  /* Make action buttons more touch-friendly */
  .btn-sm {
    padding: 8px 12px;
    min-height: 44px;
    font-size: 0.85rem;
  }
  
  /* Improve form styling for mobile */
  .form-control {
    padding: 12px;
    font-size: 16px; /* Prevents zoom on iOS */
  }
  
  .form-select {
    padding: 12px;
    font-size: 16px; /* Prevents zoom on iOS */
  }
  
  /* Card spacing adjustments */
  .card {
    margin-bottom: 1rem;
  }
  
  .card-body {
    padding: 1rem;
  }
  
  /* Header adjustments */
  .d-flex.justify-content-between.align-items-center {
    flex-direction: column;
    align-items: stretch;
    gap: 1rem;
  }
  
  .d-flex.gap-2 {
    justify-content: center;
  }
}

@media (max-width: 480px) {
  /* Extra small screens */
  .d-flex.gap-2.flex-wrap .btn {
    padding: 16px;
    min-height: 56px;
    font-size: 1rem;
  }
  
  .col-12 .d-flex.gap-2.flex-wrap .btn {
    padding: 16px;
    min-height: 56px;
    font-size: 1rem;
  }
  
  .table th,
  .table td {
    padding: 0.5rem 0.25rem;
    font-size: 0.8rem;
  }
  
  .btn-sm {
    padding: 6px 10px;
    min-height: 40px;
    font-size: 0.8rem;
  }
  
  .form-control,
  .form-select {
    padding: 14px;
    font-size: 16px;
  }
}
</style>

{% endblock %}