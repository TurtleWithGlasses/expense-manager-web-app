<canvas id="chartPie" height="120"></canvas>
<script>
(() => {
  const ctx = document.getElementById('chartPie').getContext('2d');
  const labels = {{ labels | tojson }};
  const values = {{ values | tojson }};

  // Detect current theme
  const isDarkTheme = document.documentElement.getAttribute('data-theme') !== 'light';
  const textColor = isDarkTheme ? '#fff' : '#212529';

  /* Chart.js creates a new chart; htmx swaps re-run this script each time */
  new Chart(ctx, {
    type: 'pie',
    data: {
      labels,
      datasets: [{ data: values }]
    },
    options: {
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            color: textColor
          }
        }
      }
    }
  });
})();
</script>
