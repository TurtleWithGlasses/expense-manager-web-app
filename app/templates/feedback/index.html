{% extends "base.html" %}

{% block content %}
<div class="container">
    <!-- Header -->
    <div class="text-center mb-5">
        <h1 class="h2 mb-2">We'd Love Your Feedback!</h1>
        <p class="text-muted">Help us improve by sharing your thoughts, reporting bugs, or requesting features</p>
    </div>

    <!-- Success Message -->
    {% if request.query_params.get('success') %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle me-2"></i>
        <strong>Thank you!</strong> Your feedback has been submitted successfully.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <div class="row">
        <!-- Feedback Form -->
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Submit Feedback</h5>
                </div>
                <div class="card-body">
                    <form method="post" action="/feedback/submit">
                        <!-- Feedback Type -->
                        <div class="mb-4">
                            <label class="form-label">What would you like to share?</label>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <input type="radio" class="btn-check" name="feedback_type" id="type-bug" value="bug" required>
                                    <label class="btn btn-outline-danger w-100" for="type-bug">
                                        <i class="bi bi-bug d-block fs-2 mb-2"></i>
                                        Report a Bug
                                    </label>
                                </div>
                                <div class="col-md-4">
                                    <input type="radio" class="btn-check" name="feedback_type" id="type-feature" value="feature" required>
                                    <label class="btn btn-outline-info w-100" for="type-feature">
                                        <i class="bi bi-lightbulb d-block fs-2 mb-2"></i>
                                        Request Feature
                                    </label>
                                </div>
                                <div class="col-md-4">
                                    <input type="radio" class="btn-check" name="feedback_type" id="type-feedback" value="feedback" required>
                                    <label class="btn btn-outline-secondary w-100" for="type-feedback">
                                        <i class="bi bi-chat-dots d-block fs-2 mb-2"></i>
                                        General Feedback
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Subject -->
                        <div class="mb-3">
                            <label for="subject" class="form-label">Subject</label>
                            <input type="text" class="form-control" id="subject" name="subject" placeholder="Brief summary of your feedback" required maxlength="200">
                        </div>

                        <!-- Message -->
                        <div class="mb-3">
                            <label for="message" class="form-label">Message</label>
                            <textarea class="form-control" id="message" name="message" rows="6" placeholder="Please provide details..." required></textarea>
                            <div class="form-text">Be as specific as possible to help us understand your feedback.</div>
                        </div>

                        <!-- Rating (Optional) -->
                        <div class="mb-4">
                            <label class="form-label">How would you rate your experience? (Optional)</label>
                            <div class="rating-stars">
                                <input type="radio" name="rating" id="star5" value="5">
                                <label for="star5" class="star"><i class="bi bi-star-fill"></i></label>

                                <input type="radio" name="rating" id="star4" value="4">
                                <label for="star4" class="star"><i class="bi bi-star-fill"></i></label>

                                <input type="radio" name="rating" id="star3" value="3">
                                <label for="star3" class="star"><i class="bi bi-star-fill"></i></label>

                                <input type="radio" name="rating" id="star2" value="2">
                                <label for="star2" class="star"><i class="bi bi-star-fill"></i></label>

                                <input type="radio" name="rating" id="star1" value="1">
                                <label for="star1" class="star"><i class="bi bi-star-fill"></i></label>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-send"></i> Submit Feedback
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Info Sidebar -->
        <div class="col-lg-4">
            <div class="card mb-3">
                <div class="card-body">
                    <h6 class="card-title">
                        <i class="bi bi-bug text-danger"></i> Reporting Bugs
                    </h6>
                    <p class="card-text small">
                        Found something not working? Let us know! Please include:
                        <ul class="small mb-0 mt-2">
                            <li>What you were trying to do</li>
                            <li>What happened instead</li>
                            <li>Steps to reproduce</li>
                        </ul>
                    </p>
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-body">
                    <h6 class="card-title">
                        <i class="bi bi-lightbulb text-info"></i> Feature Requests
                    </h6>
                    <p class="card-text small">
                        Have an idea to make the app better? We'd love to hear it! Describe:
                        <ul class="small mb-0 mt-2">
                            <li>What feature you'd like</li>
                            <li>Why it would be useful</li>
                            <li>How you imagine it working</li>
                        </ul>
                    </p>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h6 class="card-title">
                        <i class="bi bi-chat-dots text-secondary"></i> General Feedback
                    </h6>
                    <p class="card-text small mb-0">
                        Share your thoughts about the app! Your feedback helps us improve and build a better product.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Previous Feedback -->
    {% if user_feedback %}
    <div class="mt-5">
        <h3 class="h4 mb-3">Your Previous Feedback</h3>
        <div class="row g-3">
            {% for fb in user_feedback %}
            <div class="col-12">
                <div class="card {% if fb.is_resolved %}border-success{% endif %}">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="badge {% if fb.feedback_type == 'bug' %}bg-danger{% elif fb.feedback_type == 'feature' %}bg-info{% else %}bg-secondary{% endif %} me-2">
                                    {{ fb.feedback_type }}
                                </span>
                                <strong>{{ fb.subject }}</strong>
                            </div>
                            <div>
                                {% if fb.is_resolved %}
                                <span class="badge bg-success">
                                    <i class="bi bi-check-circle"></i> Resolved
                                </span>
                                {% else %}
                                <span class="badge bg-warning">
                                    <i class="bi bi-hourglass-split"></i> Pending
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <p class="mb-2">{{ fb.message }}</p>
                        <small class="text-muted">Submitted on {{ fb.created_at.strftime('%B %d, %Y') }}</small>

                        {% if fb.admin_response %}
                        <div class="alert alert-success mt-3 mb-0">
                            <strong><i class="bi bi-reply"></i> Admin Response:</strong><br>
                            {{ fb.admin_response }}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<style>
/* Feedback Form Styles */
.rating-stars {
    display: flex;
    flex-direction: row-reverse;
    justify-content: flex-end;
    gap: 0.5rem;
}

.rating-stars input[type="radio"] {
    display: none;
}

.rating-stars .star {
    font-size: 2rem;
    color: var(--border);
    cursor: pointer;
    transition: all 0.2s;
}

.rating-stars .star:hover,
.rating-stars .star:hover ~ .star,
.rating-stars input[type="radio"]:checked ~ .star {
    color: #fbbf24;
}

.btn-check:checked + .btn-outline-danger {
    background-color: #dc3545;
    border-color: #dc3545;
    color: white;
}

.btn-check:checked + .btn-outline-info {
    background-color: #0dcaf0;
    border-color: #0dcaf0;
    color: white;
}

.btn-check:checked + .btn-outline-secondary {
    background-color: #6c757d;
    border-color: #6c757d;
    color: white;
}

.form-control, .form-select {
    background: var(--panel);
    border-color: var(--border);
    color: var(--text);
}

.form-control:focus, .form-select:focus {
    background: var(--panel);
    border-color: #3b82f6;
    color: var(--text);
}

/* Dark theme */
[data-theme="dark"] .form-control::placeholder {
    color: #6b7280;
}

[data-theme="dark"] .alert-success {
    background-color: #064e3b;
    border-color: #065f46;
    color: #d1fae5;
}

/* Light theme */
[data-theme="light"] .form-control::placeholder {
    color: #9ca3af;
}

[data-theme="light"] .alert-success {
    background-color: #d1fae5;
    border-color: #a7f3d0;
    color: #065f46;
}
</style>

<!-- Bootstrap Bundle JS for dismissible alerts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
